

var data = [{ "name": "Korean / American", "image": "https://img1.etsystatic.com/050/1/10033535/il_340x270.664285483_hpm7.jpg", "price": "15.88", "sku": "rs-1024" }, { "name": "Batman album", "image": "https://img1.etsystatic.com/118/0/7392786/il_340x270.1011243875_b31p.jpg", "price": "53.59", "sku": "rs-1025" }, { "name": "Girl Town", "image": "https://img0.etsystatic.com/125/0/8501262/il_340x270.928717568_ol5e.jpg", "price": "23.82", "sku": "rs-1026" }, { "name": "Gravity Falls", "image": "https://img0.etsystatic.com/106/1/8646790/il_340x270.968946010_scx1.jpg", "price": "105.64", "sku": "rs-1027" }, { "name": "Set of 100 VG", "image": "https://img0.etsystatic.com/100/0/8165712/il_340x270.830891726_ktbw.jpg", "price": "151.12", "sku": "rs-1028" }, { "name": "Kitty Pryde", "image": "https://img1.etsystatic.com/041/0/9035078/il_340x270.659861593_nr7g.jpg", "price": "99.25", "sku": "rs-1029" }, { "name": "Sushi Recipe", "image": "https://img0.etsystatic.com/019/0/6728579/il_340x270.474833348_71ho.jpg", "price": "33.87", "sku": "rs-1030" }, { "name": "Hetalia Doujinshi", "image": "https://img0.etsystatic.com/005/0/5854857/il_340x270.385169524_8tlf.jpg", "price": "19.85", "sku": "rs-1031" }, { "name": "COPRA", "image": "https://img0.etsystatic.com/031/0/5563755/il_340x270.631864652_q72c.jpg", "price": "19.85", "sku": "rs-1032" }, { "name": "Another Life", "image": "https://img0.etsystatic.com/074/1/8928070/il_340x270.819296458_5ufn.jpg", "price": "41.69", "sku": "rs-1033" }, { "name": "The Knife", "image": "https://img0.etsystatic.com/018/0/7705127/il_340x270.543347058_4cls.jpg", "price": "30.93", "sku": "rs-1034" }, { "name": "Me pasa a veces", "image": "https://img0.etsystatic.com/057/0/7225891/il_340x270.751481000_eris.jpg", "price": "47.64", "sku": "rs-1035" }, { "name": "Stay Graphic", "image": "https://img0.etsystatic.com/025/0/9489851/il_340x270.612672880_gf8r.jpg", "price": "35.73", "sku": "rs-1036" }, { "name": "The Graphic Novel", "image": "https://img0.etsystatic.com/071/1/9163879/il_340x270.809015940_sh8f.jpg", "price": "67.49", "sku": "rs-1037" }, { "name": "vintage comic", "image": "https://img0.etsystatic.com/119/0/11434104/il_340x270.956675796_l7dn.jpg", "price": "44.19", "sku": "rs-1038" }, { "name": "Melvin", "image": "https://img1.etsystatic.com/134/1/12892894/il_340x270.1006426627_knog.jpg", "price": "30.93", "sku": "rs-1039" }, { "name": "Nina's geek-self", "image": "https://img0.etsystatic.com/107/1/9810047/il_340x270.855889932_fohe.jpg", "price": "10.42", "sku": "rs-1040" }, { "name": "Novela gr√°fica", "image": "https://img1.etsystatic.com/033/0/6161133/il_340x270.645489817_hgy6.jpg", "price": "79.40", "sku": "rs-1041" }, { "name": "TARZAN", "image": "https://img0.etsystatic.com/026/1/9585219/il_340x270.659744362_61yl.jpg", "price": "258.04", "sku": "rs-1042" }, { "name": "the Lost Ark", "image": "https://img1.etsystatic.com/106/1/10550812/il_340x270.902894891_20ho.jpg", "price": "103.03", "sku": "rs-1043" }, { "name": "Everyday Cooking", "image": "https://img1.etsystatic.com/050/1/10033535/il_340x270.664285483_hpm7.jpg", "price": "15.88", "sku": "rs-1044" }, { "name": "Captain Beefheart", "image": "https://img0.etsystatic.com/055/0/9401613/il_340x270.741889716_2tji.jpg", "price": "47.64", "sku": "rs-1045" }, { "name": "Breathers Graphic", "image": "https://img0.etsystatic.com/000/1/5145245/il_340x270.231817170.jpg", "price": "99.25", "sku": "rs-1046" }, { "name": "Flip Book", "image": "https://img0.etsystatic.com/052/0/9730512/il_340x270.714930990_7vfc.jpg", "price": "69.47", "sku": "rs-1047" }, { "name": "VINTAGE COMIC", "image": "https://img0.etsystatic.com/122/0/11246694/il_340x270.890804282_qwva.jpg", "price": "19.54", "sku": "rs-1048" }, { "name": "Ewenique Sheep", "image": "https://img0.etsystatic.com/000/0/5201498/il_340x270.173445414.jpg", "price": "19.85", "sku": "rs-1049" }, { "name": "Silly Scribbles", "image": "https://img0.etsystatic.com/110/0/11321027/il_340x270.871982818_132v.jpg", "price": "29.73", "sku": "rs-1050" }, { "name": "Motor City Comics", "image": "https://img1.etsystatic.com/062/0/10747431/il_340x270.776227651_3ysf.jpg", "price": "138.94", "sku": "rs-1051" }, { "name": "Hannibal fanbook", "image": "https://img1.etsystatic.com/045/1/9382722/il_340x270.733786081_dhb9.jpg", "price": "51.61", "sku": "rs-1052" }, { "name": "ZAP Comix Book", "image": "https://img0.etsystatic.com/129/0/9009414/il_340x270.877931896_9064.jpg", "price": "63.52", "sku": "rs-1053" }, { "name": "Asterix in Switzerland", "image": "https://img1.etsystatic.com/030/0/8887671/il_340x270.537200411_sd10.jpg", "price": "7.90", "sku": "rs-1054" }, { "name": "My Life in Japan", "image": "https://img1.etsystatic.com/110/0/10975515/il_340x270.1032173379_tpzb.jpg", "price": "17.50", "sku": "rs-1055" }, { "name": "Super-Heroes", "image": "https://img1.etsystatic.com/114/0/11219507/il_340x270.894053947_286p.jpg", "price": "15.84", "sku": "rs-1056" }, { "name": "Vintage 1981", "image": "https://img1.etsystatic.com/013/0/6714182/il_340x270.453949081_ihu6.jpg", "price": "11.91", "sku": "rs-1057" }, { "name": "Hungry Heart", "image": "https://img1.etsystatic.com/000/0/6346431/il_340x270.278110979.jpg", "price": "59.55", "sku": "rs-1058" }, { "name": "Teenage Mutant", "image": "https://img0.etsystatic.com/136/0/8913283/il_340x270.878871270_6yq2.jpg", "price": "39.66", "sku": "rs-1059" }, { "name": "Super Paws Zine", "image": "https://img1.etsystatic.com/000/0/5115917/il_340x270.175783063.jpg", "price": "7.94", "sku": "rs-1060" }, { "name": "Street Dawgz", "image": "https://img0.etsystatic.com/053/0/5548136/il_340x270.747594048_oj4o.jpg", "price": "26.06", "sku": "rs-1061" }, { "name": "Marco Polo", "image": "https://img0.etsystatic.com/118/0/12537971/il_340x270.968243874_l4zs.jpg", "price": "14.93", "sku": "rs-1062" }, { "name": "The mystic woods", "image": "https://img0.etsystatic.com/117/0/12351073/il_340x270.928232992_b7s9.jpg", "price": "44.19", "sku": "rs-1063" }, { "name": "Postman Pat", "image": "https://img1.etsystatic.com/061/0/9529674/il_340x270.783556337_on4e.jpg", "price": "28.66", "sku": "rs-1064" }, { "name": "history of feminism", "image": "https://img1.etsystatic.com/067/1/11153700/il_340x270.775941133_ipqx.jpg", "price": "43.31", "sku": "rs-1065" }, { "name": "Mephistos book", "image": "https://img0.etsystatic.com/008/0/5440409/il_340x270.404731148_3d5z.jpg", "price": "31.76", "sku": "rs-1066" }, { "name": "GHOSTS", "image": "https://img1.etsystatic.com/053/1/8078318/il_340x270.699225105_bysr.jpg", "price": "88.38", "sku": "rs-1067" }, { "name": "The Disappearance", "image": "https://img1.etsystatic.com/046/1/6187496/il_340x270.703556131_tpuv.jpg", "price": "27.79", "sku": "rs-1068" }, { "name": "Vintage Magneto", "image": "https://img1.etsystatic.com/110/0/5884122/il_340x270.852391139_3xvt.jpg", "price": "18.24", "sku": "rs-1069" }, { "name": "TINTIN Album", "image": "https://img1.etsystatic.com/053/0/10168866/il_340x270.766011489_n78z.jpg", "price": "309.32", "sku": "rs-1070" }, { "name": "Comic: Stinger", "image": "https://img1.etsystatic.com/115/0/13134732/il_340x270.1031654989_s7lf.jpg", "price": "31.27", "sku": "rs-1071" }];

const exp = require('express');
var app = exp();

const fs = require('fs');

var bodyParser = require('body-parser');
app.use(bodyParser.urlencoded());

app.use(exp.static(__dirname));


app.get('/', function (req, res) {
    // res.status(200).sendfile('index1.html');
})

app.post('/data.json', function (req, res) {
    // res.status(200).sendfile('index1.html');
    var to = req.body['to'] - (req.body['from'] - 1);
    var dataItem = data.splice(0, to);
    res.status(200).send(dataItem);
})



app.post('/cartData', function (req, res) {
    var fileName = req.connection.remoteAddress;
    var cartProd = req.body.data;
    storeDataFile(fileName, cartProd);
    res.status(200).send('1');

})

function storeDataFile(fileName, cartProd) {
    fs.appendFile(`./user${fileName}.txt`, `${cartProd}`, function (err) {
        if (err) {
            throw err;
        }
    });
}


// loadCart

var path = require('path');


app.post('/loadCart', function (req, res) {
    function parseData(cartDat) {
        var str = '';
        for (var i = 0; i < cartDat.length; i++) {
            str += cartDat.charAt(i);
            if (cartDat.charAt(i) == '}') {
                str += ',';
            }
        }
        str = str.substr(0, str.length - 1);
        str = '[' + str + ']';
        return str;
    }
    var fileName = req.connection.remoteAddress;
    try {
        var cartDat = loadDataFile(fileName);
        var dataParse = parseData(cartDat);
        res.send(JSON.parse(dataParse));
    } catch (err) {
        console.log('file does not exists for the user');
        res.send(undefined);
    }


})



function loadDataFile(fileName, cartProd) {
    return fs.readFileSync(`./user${fileName}.txt`, 'utf8', function (err, data) {
        if (err) {
            throw err;
        }
    });
}


app.post('/deleteUserFile', function (req, res) {
    var fileName = req.connection.remoteAddress;
    fs.unlinkSync('user' + fileName+'.txt');
    res.send("1");

});

app.listen(2222, function () {
    console.log('Start server1');
});




